WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WLeafletMap",(function(t,e,o,n,i,p){e.wtObj&&e.wtObj.map.remove();e.wtObj=this;const a=this;this.map=null;const l={};let d=p,m=[n,i];this.addTileLayer=function(t,e){const o=JSON.parse(e);L.tileLayer(t,o).addTo(a.map)};this.zoom=function(t){d=t;a.map.setZoom(t)};this.panTo=function(t,e){m=[t,e];a.map.panTo([t,e])};this.addPolyline=function(t,e){const o=JSON.parse(e);L.polyline(t,o).addTo(a.map)};this.addCircle=function(t,e){const o=JSON.parse(e);L.circle(t,o).addTo(a.map)};this.addPopup=function(t,e,o){o.item_type=1;a.addOverlayItem(t,e,o)};this.addTooltip=function(t,e,o){o.item_type=0;a.addOverlayItem(t,e,o)};this.addOverlayItem=function(t,o,n){n.contentHolder=document.createElement("div");n.contentHolder.style.cssText="visibility: hidden;";e.appendChild(n.contentHolder);n.item_id=t;n.parent_id=o;l[t]=n;a.toggleOverlayItem(t,!0)};this.addMapItem=function(t,e,o){o.addTo(a.map);l[t]=o};this.removeMapItem=function(t){const e=l[t];if(e){const o=e.parent_id;if((o||0===o)&&-1!==o){const e=l[o];e&&(e.getPopup()&&e.getPopup().item_id===t?e.unbindPopup():e.getTooltip()&&e.getTooltip().item_id===t&&e.unbindTooltip())}e.contentHolder&&e.contentHolder.remove();a.map.removeLayer(e);delete l[t]}};this.moveMapItem=function(t,e){const o=l[t];o&&o.setLatLng(e)};this.setOverlayItemContent=function(t,e,o){const n=l[t];if(n){n.contentId=o;n.contentHolder.innerHTML=e;if(n.isOpen()){const t=n.contentHolder.firstChild;n.setContent(n.contentHolder.removeChild(t))}a.delayedJS()}};this.moveOverlayItemToFront=function(t){const e=l[t];e&&e.bringToFront()};this.moveOverlayItemToBack=function(t){const e=l[t];e&&e.bringToBack()};this.toggleOverlayItem=function(t,e){const o=l[t];if(o)if(e&&!o.isOpen()){const t=o.parent_id;if(-1===t)o.openOn(this.map);else{const e=l[t];e&&(1===o.item_type?e.bindPopup(o).openPopup():0===o.item_type&&e.bindTooltip(o).openTooltip())}}else!e&&o.isOpen()&&o.close()};this.wtResize=function(){a.map.invalidateSize()};e.wtEncodeValue=function(){const t=a.map.getCenter(),e=[t.lat,t.lng],o=a.map.getZoom();return JSON.stringify({position:e,zoom:o})};this.init=function(o,n,i){const p=JSON.parse(o);p.center=n;p.zoom=i;a.map=L.map(e,p);const l=parseInt(function(){let t=e.parentNode;for(;t;){if(t.wtPopup)return t.style.zIndex;t=t.parentNode}return 0}(),10);if(l>0){a.map.getPane("tilePane").style.zIndex=l+200;a.map.getPane("overlayPane").style.zIndex=l+400;a.map.getPane("shadowPane").style.zIndex=l+500;a.map.getPane("markerPane").style.zIndex=l+600;a.map.getPane("tooltipPane").style.zIndex=l+650;a.map.getPane("popupPane").style.zIndex=l+700}a.map.on("zoomend",(function(){const o=a.map.getZoom();if(o!==d){t.emit(e,"zoomLevelChanged",o);d=o}}));a.map.on("moveend",(function(){const o=a.map.getCenter();if(o.lat!==m[0]||o.lng!==m[1]){t.emit(e,"panChanged",o.lat,o.lng);m=[o.lat,o.lng]}}));a.map.on("popupclose",(function(o){const n=o.popup.getContent();n.remove();o.popup.contentHolder.appendChild(n);t.emit(e,"overlayItemToggled",o.popup.item_id,!1)}));a.map.on("popupopen",(function(o){const n=o.popup.contentHolder.firstChild;n&&o.popup.setContent(o.popup.contentHolder.removeChild(n));t.emit(e,"overlayItemToggled",o.popup.item_id,!0)}));a.map.on("tooltipclose",(function(o){const n=o.tooltip.getContent();n.remove();o.tooltip.contentHolder.appendChild(n);t.emit(e,"overlayItemToggled",o.tooltip.item_id,!1)}));a.map.on("tooltipopen",(function(o){const n=o.tooltip.contentHolder.firstChild;n&&o.tooltip.setContent(o.tooltip.contentHolder.removeChild(n));t.emit(e,"overlayItemToggled",o.tooltip.item_id,!0)}))};this.init(o,[n,i],p)}));